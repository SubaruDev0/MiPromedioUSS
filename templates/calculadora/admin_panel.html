{% extends 'calculadora/base.html' %}

{% block content %}
<div class="container admin-centered" style="padding-top: 20px;">
    <div class="calculator-card">
        <h2 style="color: var(--primary-color); margin-bottom: 10px;">Panel de Administración</h2>

        <div style="display:flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.95rem; color: var(--text-secondary);">Usuarios registrados: <strong>{{ users_count }}</strong></div>
            <form method="post" style="margin:0;">
                {% csrf_token %}
                <input type="hidden" name="action" value="clear_cache">
                <button type="submit" class="btn-secondary">Limpiar Caché</button>
            </form>
        </div>

        <hr style="margin: 12px 0; border-top: 1px solid var(--divider-color);">

        <div class="table-wrapper" style="max-height: 60vh; overflow:auto;">
            <table class="responsive-table" style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align:left; border-bottom:1px solid var(--border-color);">
                        <th style="padding:8px">ID</th>
                        <th style="padding:8px">Usuario</th>
                        <th style="padding:8px">Email</th>
                        <th style="padding:8px">Superuser</th>
                        <th style="padding:8px">Staff</th>
                        <th style="padding:8px">Creado</th>
                        <th style="padding:8px">Último login</th>
                        <th style="padding:8px">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr style="border-bottom:1px solid var(--divider-color);">
                        <td data-label="ID" style="padding:8px">{{ u.id }}</td>
                        <td data-label="Usuario" style="padding:8px">{{ u.username }}</td>
                        <td data-label="Email" style="padding:8px">{{ u.email }}</td>
                        <td data-label="Superuser" style="padding:8px">{{ u.is_superuser }}</td>
                        <td data-label="Staff" style="padding:8px">{{ u.is_staff }}</td>
                        <td data-label="Creado" style="padding:8px">{{ u.date_joined }}</td>
                        <td data-label="Último login" style="padding:8px">{{ u.last_login }}</td>
                        <td data-label="Acciones" style="padding:8px">
                            <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
                                <a href="{% url 'admin_user_ramos' u.id %}" class="btn-secondary" style="text-decoration:none; padding:6px 8px;">Ver Ramos</a>
                                <form method="post" action="{% url 'admin_delete_user' u.id %}" style="margin:0;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-remove" style="background:var(--danger-light); color:var(--danger-color);">Borrar</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" style="padding:8px">No hay usuarios registrados.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
