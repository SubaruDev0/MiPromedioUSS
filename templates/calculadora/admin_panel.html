{% extends 'calculadora/base.html' %}

{% block content %}
<div class="container admin-centered" style="padding-top: 20px;">
    <div class="calculator-card">
        <h2 style="color: var(--primary-color); margin-bottom: 10px;">Panel de Administración</h2>

        <div style="display:flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.95rem; color: var(--text-secondary);">Usuarios registrados: <strong>{{ users_count }}</strong></div>
            <form method="post" style="margin:0;">
                {% csrf_token %}
                <input type="hidden" name="action" value="clear_cache">
                <button type="submit" class="btn-secondary">Limpiar Caché</button>
            </form>
        </div>

        <hr style="margin: 12px 0; border-top: 1px solid var(--divider-color);">

        <div style="overflow:auto; max-height: 60vh;">
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="text-align:left; border-bottom:1px solid var(--border-color);">
                        <th style="padding:8px">ID</th>
                        <th style="padding:8px">Usuario</th>
                        <th style="padding:8px">Email</th>
                        <th style="padding:8px">Superuser</th>
                        <th style="padding:8px">Staff</th>
                        <th style="padding:8px">Creado</th>
                        <th style="padding:8px">Último login</th>
                        <th style="padding:8px">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr style="border-bottom:1px solid var(--divider-color);">
                        <td style="padding:8px">{{ u.id }}</td>
                        <td style="padding:8px">{{ u.username }}</td>
                        <td style="padding:8px">{{ u.email }}</td>
                        <td style="padding:8px">{{ u.is_superuser }}</td>
                        <td style="padding:8px">{{ u.is_staff }}</td>
                        <td style="padding:8px">{{ u.date_joined }}</td>
                        <td style="padding:8px">{{ u.last_login }}</td>
                        <td style="padding:8px">
                            <div style="display:flex; gap:6px;">
                                <a href="{% url 'admin_user_ramos' u.id %}" class="btn-secondary" style="text-decoration:none; padding:6px 8px;">Ver Ramos</a>
                                <form method="post" action="{% url 'admin_delete_user' u.id %}" style="margin:0;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-remove" style="background:var(--danger-light); color:var(--danger-color);">Borrar</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="8" style="padding:8px">No hay usuarios registrados.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<style>
    /* Desktop: make admin panel wider and centered */
    .container.admin-centered {
        display: flex;
        justify-content: center;
    }

    @media (min-width: 992px) {
        .calculator-card {
            max-width: 1100px;
            width: 80%;
            min-width: 820px;
            margin: 0 auto;
            padding: calc(var(--spacing-lg) + 8px);
        }
    }

    /* Table styling: allow wrapping and better spacing to avoid horizontal scroll */
    .calculator-card .table-wrapper {
        width: 100%;
        overflow: visible;
    }

    .calculator-card table {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
    }

    .calculator-card th, .calculator-card td {
        padding: 8px 10px;
        font-size: 0.95rem;
        white-space: normal;
        vertical-align: middle;
    }

    .calculator-card thead th { font-weight: 700; }

    .calculator-card tbody tr td .btn-secondary { padding: 6px 10px; font-size: 0.92rem; }
    .calculator-card tbody tr td .btn-remove { padding: 6px 10px; font-size: 0.92rem; }

    /* Reduce excessive left/right margins on very large screens */
    @media (min-width: 1400px) {
        .calculator-card { width: 70%; max-width: 1400px; }
    }

    /* On small screens keep table responsive */
    @media (max-width: 991px) {
        .calculator-card table { table-layout: auto; }
    }
</style>
{% endblock %}
